import os
import json
import base64
import time
from openai import OpenAI

def build_concise_prompt_r(similar_intent_rules): #需要补充应该带入的变量
    """严格按照指定格式构建提示词"""
    # 处理现有的混淆意图判定规则表
    similar_intent_display = similar_intent_rules

    prompt = f"""
你是一个社会认知与逻辑泛化专家。你的职责是审查、精炼并优化“社交媒体意图识别知识库”。你需要确保知识库中的每一条规则都具备普适性，而非仅针对特定案例的“过度拟合”。

注意：本任务遇到的情感是情感倾向，只有积极（positive）、消极（negative）和无明显情感（neutral）。代理意图属于开集合，可为空，不止是预定的意图标签。

核心审查逻辑（内心思考准则）
规则保留：对于原规则中不涉及本次更新的规则，请原样保留。例如，若本次需要更新的只有[抱怨 vs 妥协]和[询问 vs 求助]规则，那么其他规则务必原样保留。

对于涉及更新的规则：
去偏见与泛化：判定规则中的细节，泛化一些具体人名和事件示例：将“张三的大笑”泛化为“大笑”；将“足球踢的特别好”泛化为“夸奖”，达到[小狗形象-萌宠形象]的程度即可，但具体的代理意图务必保留。
语义去重：[大拇指] 与 [点赞手势] 属于同义，需合并为更准确的一条，如[大拇指]。
规则收敛：如果两条判定规则逻辑类似，请合并为一条更具概括性的准则，但注意保留区分不同意图的关键代理意图和具体方法，绝不能高度概括使得规则的具体细节丢失；若逻辑不同，则保留逻辑最不牵强的那一条，且注意不能改变规则中意图和代理意图的名称。

输出格式要求
严格按照以下格式输出，严禁包含任何解释性文字或开场白，务必注意省略号和判定规则只是必要的填充，不是一定要填充，是可为空的：

混淆意图判定规则：
[意图A vs 意图B]：判定规则内容
...

输入信息定义

• 混淆意图判定规则表：
{similar_intent_display}

"""

    return prompt